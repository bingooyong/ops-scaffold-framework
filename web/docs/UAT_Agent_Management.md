# Agent 管理功能 - 用户验收测试清单

## 测试环境准备

1. **启动 Manager 服务**
   ```bash
   cd manager
   make run-dev
   ```

2. **启动 Daemon 服务**（在测试节点上）
   ```bash
   cd daemon
   ./daemon
   ```

3. **启动 Web 前端**
   ```bash
   cd web
   npm run dev
   ```

4. **登录系统**
   - 访问 `http://localhost:5173/login`
   - 使用测试账号登录

## 测试场景

### 场景 1: Agent 列表查看

**测试步骤**:
1. 登录系统
2. 导航到"节点列表"页面
3. 点击任意在线节点，进入节点详情页
4. 切换到"Agents" Tab

**预期结果**:
- ✅ Agent 列表正确显示
- ✅ 表格包含以下列：Agent ID、类型、版本、状态、PID、最后心跳、操作
- ✅ Agent 状态 Chip 颜色正确：
  - 运行中：绿色（success）
  - 已停止：灰色（default）
  - 错误/失败：红色（error）
  - 启动中/停止中/重启中：黄色（warning）
- ✅ 列表每 30 秒自动刷新
- ✅ 手动刷新按钮正常工作

**测试数据**:
- 节点 ID: `node-1`
- 预期 Agent 数量: 根据实际配置

---

### 场景 2: Agent 操作（启动/停止/重启）

**测试步骤**:
1. 进入节点详情页的 Agents Tab
2. 找到状态为"已停止"的 Agent
3. 点击"启动"按钮（▶️）
4. 观察状态变化和提示信息
5. 找到状态为"运行中"的 Agent
6. 点击"停止"按钮（⏹️）
7. 观察状态变化和提示信息
8. 点击"重启"按钮（🔄）
9. 观察状态变化和提示信息

**预期结果**:
- ✅ 启动操作：
  - 按钮点击后立即禁用
  - 显示"Agent 启动成功"提示
  - Agent 状态更新为"启动中"或"运行中"
  - 列表自动刷新
- ✅ 停止操作：
  - 按钮点击后立即禁用
  - 显示"Agent 停止成功"提示
  - Agent 状态更新为"停止中"或"已停止"
  - 列表自动刷新
- ✅ 重启操作：
  - 按钮点击后立即禁用
  - 显示"Agent 重启成功"提示
  - Agent 状态更新为"重启中"
  - 列表自动刷新
- ✅ 按钮禁用逻辑正确：
  - 运行中的 Agent：启动按钮禁用
  - 已停止的 Agent：停止和重启按钮禁用
  - 操作进行中：所有操作按钮禁用

**错误场景测试**:
- ✅ 操作失败时显示错误提示
- ✅ 错误提示可以手动关闭
- ✅ 操作失败后按钮状态恢复正常

---

### 场景 3: Agent 日志查看

**测试步骤**:
1. 进入节点详情页的 Agents Tab
2. 找到任意 Agent
3. 点击"查看日志"按钮（📄）
4. 观察日志 Dialog 显示
5. 验证日志内容
6. 点击"刷新"按钮
7. 点击"导出"按钮
8. 验证文件下载
9. 切换"自动刷新"开关
10. 关闭 Dialog

**预期结果**:
- ✅ Dialog 正确打开，显示 Agent ID
- ✅ 日志内容正确显示：
  - 使用 monospace 字体
  - 深色背景（grey.900）
  - 支持滚动
  - 日志行正确换行
- ✅ 刷新功能：
  - 点击刷新按钮后重新获取日志
  - 显示刷新状态指示
- ✅ 自动刷新：
  - 开启后每 5 秒自动刷新
  - 显示"自动刷新中..."提示
  - 关闭后停止自动刷新
- ✅ 导出功能：
  - 点击导出后下载文件
  - 文件名格式：`agent-{agentId}-logs-{timestamp}.txt`
  - 文件内容为日志文本
- ✅ 错误处理：
  - 501 错误显示"日志功能暂未实现，请稍后重试"
  - 其他错误显示具体错误信息
  - 提供重试按钮
- ✅ Dialog 关闭功能正常

**测试数据**:
- Agent ID: `agent-1`
- 预期日志行数: 100 行（默认）

---

### 场景 4: Agent 监控图表

**测试步骤**:
1. 进入节点详情页的 Agents Tab
2. 点击 Agent 表格行，选择 Agent
3. 观察监控图表区域显示
4. 验证 CPU 使用率图表
5. 验证内存使用率图表
6. 切换时间范围（1小时/6小时/24小时）
7. 观察图表数据更新
8. 选择不同的 Agent
9. 观察图表数据更新

**预期结果**:
- ✅ Agent 选择：
  - 点击表格行后 Agent 被选中（高亮显示）
  - 监控图表区域显示
  - 显示选中 Agent 的 ID
- ✅ 图表显示：
  - CPU 使用率图表正确显示
  - 内存使用率图表正确显示
  - 图表标题和单位正确
  - 加载状态正确显示
- ✅ 时间范围切换：
  - 1小时/6小时/24小时按钮正常工作
  - 切换后图表数据重新获取
  - 图表数据正确更新
- ✅ Agent 切换：
  - 选择不同 Agent 后图表数据更新
  - 显示新 Agent 的监控数据
- ✅ 错误处理：
  - 加载失败时显示错误提示
  - 提供重试按钮

**测试数据**:
- 时间范围: 1小时、6小时、24小时
- 图表类型: CPU、内存

---

### 场景 5: 空状态和错误状态

**测试步骤**:
1. 进入没有 Agent 的节点详情页
2. 观察空状态显示
3. 模拟 API 错误（如网络断开）
4. 观察错误状态显示

**预期结果**:
- ✅ 空状态：
  - 显示"该节点下暂无 Agent"提示
  - 提示居中显示
- ✅ 错误状态：
  - 显示错误提示信息
  - 提供重试按钮
  - 重试按钮功能正常

---

## 跨浏览器测试

### Chrome
- ✅ 所有功能正常
- ✅ 样式正确显示
- ✅ 交互流畅

### Firefox
- ✅ 所有功能正常
- ✅ 样式正确显示
- ✅ 交互流畅

### Safari（如果支持）
- ✅ 所有功能正常
- ✅ 样式正确显示
- ✅ 交互流畅

### Edge（如果支持）
- ✅ 所有功能正常
- ✅ 样式正确显示
- ✅ 交互流畅

---

## 性能测试

**测试指标**:
- ✅ 页面加载时间 < 2 秒
- ✅ Agent 列表渲染时间 < 500ms
- ✅ 操作响应时间 < 1 秒
- ✅ 图表渲染时间 < 1 秒
- ✅ 自动刷新不影响页面性能

---

## 响应式设计测试

**测试断点**:
- ✅ 桌面（> 1200px）：所有功能正常
- ✅ 平板（768px - 1200px）：布局适配，功能正常
- ✅ 手机（< 768px）：布局适配，功能正常

---

## 可访问性测试

- ✅ 键盘导航正常
- ✅ 屏幕阅读器兼容（如果使用）
- ✅ 颜色对比度符合 WCAG 标准
- ✅ 焦点状态清晰可见

---

## 测试记录

| 测试场景 | 测试日期 | 测试人员 | 结果 | 备注 |
|---------|---------|---------|------|------|
| 场景 1: Agent 列表查看 | | | ⬜ 通过 / ⬜ 失败 | |
| 场景 2: Agent 操作 | | | ⬜ 通过 / ⬜ 失败 | |
| 场景 3: Agent 日志查看 | | | ⬜ 通过 / ⬜ 失败 | |
| 场景 4: Agent 监控图表 | | | ⬜ 通过 / ⬜ 失败 | |
| 场景 5: 空状态和错误状态 | | | ⬜ 通过 / ⬜ 失败 | |
| 跨浏览器测试 | | | ⬜ 通过 / ⬜ 失败 | |
| 性能测试 | | | ⬜ 通过 / ⬜ 失败 | |
| 响应式设计测试 | | | ⬜ 通过 / ⬜ 失败 | |
| 可访问性测试 | | | ⬜ 通过 / ⬜ 失败 | |

---

## 已知问题

（记录测试过程中发现的问题）

---

## 测试结论

- [ ] 所有测试场景通过
- [ ] 发现的问题已修复
- [ ] 功能满足需求文档要求
- [ ] 可以进入生产环境

**测试签名**: _________________  
**日期**: _________________
