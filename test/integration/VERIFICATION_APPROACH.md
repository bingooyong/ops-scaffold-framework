## Daemon Agentç®¡ç†åŠŸèƒ½åŸå­æ€§éªŒè¯æ–¹æ¡ˆ

æ ¹æ®ä½ çš„å»ºè®®ï¼Œæˆ‘åˆ›å»ºäº†ä¸€å¥—ç‹¬ç«‹çš„Daemon Agentç®¡ç†åŠŸèƒ½éªŒè¯æ–¹æ¡ˆï¼Œå®Œå…¨ä¸ä¾èµ–Managerï¼Œä»æœ€åº•å±‚å¼€å§‹éªŒè¯ã€‚

### ğŸ¯ ç›®æ ‡

**åˆ†ç¦»éªŒè¯Daemonçš„Agentç®¡ç†åŠŸèƒ½**ï¼Œç¡®ä¿åœ¨é›†æˆManagerä¹‹å‰ï¼ŒDaemonçš„Multi-Agentç®¡ç†æ ¸å¿ƒåŠŸèƒ½æ˜¯æ­£å¸¸å·¥ä½œçš„ã€‚

### ğŸ“¦ åˆ›å»ºçš„æ–‡ä»¶

#### 1. ä¸€é”®éªŒè¯è„šæœ¬ï¼ˆæ¨èä½¿ç”¨ï¼‰
**æ–‡ä»¶**: `test/integration/quick_verify.sh`

```bash
cd test/integration
./quick_verify.sh
```

**åŠŸèƒ½**:
- âœ… è‡ªåŠ¨æ„å»ºDaemonå’ŒAgentäºŒè¿›åˆ¶
- âœ… æ¸…ç†æµ‹è¯•ç¯å¢ƒ
- âœ… è¿è¡Œç‹¬ç«‹æµ‹è¯•
- âœ… ç”Ÿæˆæµ‹è¯•æŠ¥å‘Š
- âœ… æä¾›ä¸‹ä¸€æ­¥å»ºè®®

#### 2. ç®€åŒ–éªŒè¯è„šæœ¬ï¼ˆæ ¸å¿ƒæµ‹è¯•ï¼‰
**æ–‡ä»¶**: `test/integration/test_daemon_simple.sh`

```bash
cd test/integration
./test_daemon_simple.sh
```

**éªŒè¯å†…å®¹**:
- âœ… Daemonå¯åŠ¨å¹¶è‡ªåŠ¨åŠ è½½é…ç½®çš„Agents
- âœ… æ‰€æœ‰Agentè¿›ç¨‹æ­£å¸¸å¯åŠ¨
- âœ… å…ƒæ•°æ®æ–‡ä»¶æ­£ç¡®ç”Ÿæˆ
- âœ… æ—¥å¿—è®°å½•å®Œæ•´æ— è¯¯

**ç‰¹ç‚¹**: ä¸éœ€è¦grpcurlï¼Œçº¯ç²¹é€šè¿‡è¿›ç¨‹æ£€æŸ¥ã€æ—¥å¿—åˆ†æå’Œæ–‡ä»¶éªŒè¯

#### 3. å®Œæ•´æµ‹è¯•è„šæœ¬ï¼ˆéœ€è¦grpcurlï¼‰
**æ–‡ä»¶**: `test/integration/test_daemon_standalone.sh`

```bash
cd test/integration
./test_daemon_standalone.sh
```

**æµ‹è¯•åœºæ™¯**:
- âœ… Agentåœæ­¢æ“ä½œï¼ˆé€šè¿‡gRPCï¼‰
- âœ… Agentå¯åŠ¨æ“ä½œï¼ˆé€šè¿‡gRPCï¼‰
- âœ… Agenté‡å¯æ“ä½œï¼ˆé€šè¿‡gRPCï¼‰

**ç‰¹ç‚¹**: éœ€è¦å®‰è£…grpcurlå·¥å…·ï¼Œèƒ½å¤Ÿæµ‹è¯•gRPCæ¥å£

#### 4. Goæµ‹è¯•ç¨‹åºï¼ˆå®Œå…¨ç‹¬ç«‹ï¼‰
**æ–‡ä»¶**: `daemon/test/standalone/test_agent_lifecycle.go`

```bash
cd daemon/test/standalone
go run test_agent_lifecycle.go -verbose
```

**ç‰¹ç‚¹**: 
- å®Œå…¨ç‹¬ç«‹çš„Goæµ‹è¯•ç¨‹åº
- ä¸ä¾èµ–ç°æœ‰é…ç½®
- åˆ›å»ºæ¨¡æ‹ŸAgentè¿›ç¨‹
- æµ‹è¯•å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸ

#### 5. è¯¦ç»†æ–‡æ¡£
**æ–‡ä»¶**: `test/integration/DAEMON_STANDALONE_TEST.md`

åŒ…å«ï¼š
- ğŸ“– æµ‹è¯•ç›®æ ‡å’Œå‰ç½®æ¡ä»¶
- ğŸš€ ä¸‰ç§è¿è¡Œæ–¹å¼çš„è¯¦ç»†è¯´æ˜
- ğŸ“Š ç»“æœæŸ¥çœ‹æ–¹æ³•
- ğŸ” æ•…éšœæ’æŸ¥æŒ‡å—
- ğŸ“ æµ‹è¯•è¾“å‡ºç¤ºä¾‹

### ğŸ”„ éªŒè¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬ä¸€å±‚ï¼šDaemon Agentç®¡ç†åŠŸèƒ½ï¼ˆç‹¬ç«‹éªŒè¯ï¼‰          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. å¯åŠ¨Daemon                                      â”‚
â”‚  2. è‡ªåŠ¨åŠ è½½é…ç½®æ–‡ä»¶ä¸­çš„Agents                     â”‚
â”‚  3. å¯åŠ¨æ‰€æœ‰Agents                                 â”‚
â”‚  4. éªŒè¯è¿›ç¨‹ã€å…ƒæ•°æ®ã€æ—¥å¿—                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… é€šè¿‡ â†’ è¿›å…¥ç¬¬äºŒå±‚æµ‹è¯•                          â”‚
â”‚  âŒ å¤±è´¥ â†’ ä¿®å¤Daemon Agentç®¡ç†é€»è¾‘                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç¬¬äºŒå±‚ï¼šManager-Daemoné€šä¿¡ï¼ˆé›†æˆæµ‹è¯•ï¼‰            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  1. å¯åŠ¨Managerå’ŒDaemon                            â”‚
â”‚  2. Manageré€šè¿‡gRPCè°ƒç”¨Daemonæ“ä½œAgent             â”‚
â”‚  3. éªŒè¯é€šä¿¡ã€è¶…æ—¶ã€é”™è¯¯å¤„ç†                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  âœ… é€šè¿‡ â†’ åŠŸèƒ½å®Œæ•´                                â”‚
â”‚  âŒ å¤±è´¥ â†’ ä¿®å¤gRPCé€šä¿¡ã€è¶…æ—¶é…ç½®                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸš€ å¿«é€Ÿå¼€å§‹

#### æœ€ç®€å•çš„æ–¹å¼ï¼ˆæ¨èï¼‰

```bash
cd /Users/bingooyong/00Documents/00Code/ops-scaffold-framework
./test/integration/quick_verify.sh
```

è¿™ä¸ªè„šæœ¬ä¼šï¼š
1. è‡ªåŠ¨æ„å»ºæ‰€éœ€äºŒè¿›åˆ¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
2. æ¸…ç†ç¯å¢ƒ
3. è¿è¡ŒDaemonç‹¬ç«‹æµ‹è¯•
4. ç”ŸæˆæŠ¥å‘Šå¹¶æ˜¾ç¤ºç»“æœ

#### æ‰‹åŠ¨æ–¹å¼ï¼ˆæ›´å¤šæ§åˆ¶ï¼‰

```bash
# 1. æ„å»ºäºŒè¿›åˆ¶
cd daemon && make build
cd ../agent && make build

# 2. æ¸…ç†ç¯å¢ƒ
cd ../test/integration
pkill -f "daemon/daemon" 2>/dev/null || true
pkill -f "agent/bin/agent" 2>/dev/null || true
rm -rf tmp/ pids/

# 3. è¿è¡Œæµ‹è¯•
./test_daemon_simple.sh

# 4. æŸ¥çœ‹æŠ¥å‘Š
cat reports/daemon_standalone_test_report.md
```

### ğŸ“Š æµ‹è¯•æŠ¥å‘Š

è¿è¡Œåä¼šç”Ÿæˆè¯¦ç»†çš„MarkdownæŠ¥å‘Šï¼š
**ä½ç½®**: `test/integration/reports/daemon_standalone_test_report.md`

æŠ¥å‘ŠåŒ…å«ï¼š
- âœ… æ¯ä¸ªæµ‹è¯•æ­¥éª¤çš„é€šè¿‡/å¤±è´¥çŠ¶æ€
- ğŸ“ Agentè¿›ç¨‹çŠ¶æ€ï¼ˆPIDã€Statusï¼‰
- ğŸ“‹ Daemonæ—¥å¿—æ‘˜è¦
- ğŸ“„ å…ƒæ•°æ®æ–‡ä»¶å†…å®¹
- ğŸ”§ æ•…éšœæ’æŸ¥å»ºè®®

### ğŸ” éªŒè¯çš„å…³é”®ç‚¹

#### 1. Agentè‡ªåŠ¨åŠ è½½
```yaml
# ä» daemon.test.yaml åŠ è½½
agents:
  - id: agent-001
    type: custom
    binary_path: /path/to/agent
    ...
  - id: agent-002
    ...
```

**éªŒè¯**: Daemonæ—¥å¿—ä¸­åº”è¯¥æœ‰ "agent registered" è®°å½•

#### 2. Agentè¿›ç¨‹å¯åŠ¨
**éªŒè¯æ–¹æ³•**:
```bash
# æ£€æŸ¥è¿›ç¨‹
ps aux | grep "agent/bin/agent"

# æ£€æŸ¥å…ƒæ•°æ®
cat test/integration/tmp/daemon/metadata/agent-001.json
```

**é¢„æœŸç»“æœ**:
```json
{
  "id": "agent-001",
  "type": "custom",
  "status": "running",
  "pid": 12345,
  "start_time": "2025-12-07T...",
  ...
}
```

#### 3. æ—¥å¿—å®Œæ•´æ€§
**å…³é”®æ—¥å¿—**:
- `agent registered` - Agentæ³¨å†ŒæˆåŠŸ
- `agent started` - Agentå¯åŠ¨æˆåŠŸ
- `agent instance created from registry` - ä»æ³¨å†Œè¡¨åˆ›å»ºå®ä¾‹

#### 4. å…ƒæ•°æ®æŒä¹…åŒ–
**éªŒè¯**: æ¯ä¸ªAgentéƒ½æœ‰å¯¹åº”çš„JSONæ–‡ä»¶
```bash
ls test/integration/tmp/daemon/metadata/
# åº”è¯¥çœ‹åˆ°: agent-001.json, agent-002.json, agent-003.json
```

### ğŸ“ ä½¿ç”¨ç°æœ‰é…ç½®

æ‰€æœ‰æµ‹è¯•è„šæœ¬éƒ½ä½¿ç”¨ `@integration` ç›®å½•ä¸‹çš„é…ç½®ï¼š
- âœ… `config/daemon.test.yaml` - Daemoné…ç½®
- âœ… `config/agent-001.test.yaml` - Agenté…ç½®
- âœ… ä½¿ç”¨ç°æœ‰çš„AgentäºŒè¿›åˆ¶: `agent/bin/agent`
- âœ… å¤ç”¨æ—¥å¿—ç›®å½•: `test/integration/logs/`
- âœ… å¤ç”¨ä¸´æ—¶ç›®å½•: `test/integration/tmp/`

### ğŸ“ ä¸‹ä¸€æ­¥

1. **è¿è¡Œç‹¬ç«‹éªŒè¯**:
   ```bash
   ./test/integration/quick_verify.sh
   ```

2. **å¦‚æœé€šè¿‡**: Daemonçš„Agentç®¡ç†åŠŸèƒ½æ­£å¸¸ï¼Œå¯ä»¥è¿›å…¥Manager-Daemoné›†æˆæµ‹è¯•
   ```bash
   ./test/integration/start_test_env.sh
   ./test/integration/test_business_flows.sh
   ```

3. **å¦‚æœå¤±è´¥**: æŸ¥çœ‹æŠ¥å‘Šå’Œæ—¥å¿—ï¼Œä¿®å¤Daemonçš„Agentç®¡ç†é€»è¾‘
   ```bash
   cat test/integration/reports/daemon_standalone_test_report.md
   cat test/integration/logs/daemon.log
   ```

### ğŸ”§ æ•°æ®åº“é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰

æ ¹æ®ä½ æä¾›çš„æ•°æ®åº“ä¿¡æ¯ï¼š
```yaml
MYSQL_ROOT_PASSWORD: rootpassword
MYSQL_DATABASE: ops_framework_dev
```

ä¸è¿‡Daemonç‹¬ç«‹æµ‹è¯•**ä¸éœ€è¦æ•°æ®åº“**ï¼Œå› ä¸ºï¼š
- âœ… Daemonä½¿ç”¨æœ¬åœ°æ–‡ä»¶å­˜å‚¨å…ƒæ•°æ®
- âœ… Agentç®¡ç†å®Œå…¨åœ¨Daemonå†…éƒ¨
- âœ… åªæœ‰Manageréœ€è¦æ•°æ®åº“

åªæœ‰åœ¨è¿è¡Œå®Œæ•´çš„é›†æˆæµ‹è¯•æ—¶ï¼ŒManageræ‰éœ€è¦æ•°æ®åº“ã€‚

---

**åˆ›å»ºæ—¶é—´**: 2025-12-07  
**ç›®çš„**: åŸå­æ€§éªŒè¯Daemonçš„Agentç®¡ç†åŠŸèƒ½  
**ä¼˜åŠ¿**: åˆ†å±‚æµ‹è¯•ï¼Œé—®é¢˜å®šä½æ›´å‡†ç¡®
