# API æ–‡æ¡£ç›®å½•

æœ¬ç›®å½•åŒ…å« Ops Scaffold Framework å„ç»„ä»¶çš„ API æ–‡æ¡£ã€‚

## ğŸ“š æ–‡æ¡£åˆ—è¡¨

### Manager API
- **æ–‡æ¡£**: [Manager_API.md](./Manager_API.md)
- **åè®®**: HTTP/HTTPS + gRPC
- **ç«¯å£**:
  - HTTP: 8080
  - gRPC: 9090
- **è®¤è¯**: JWT Bearer Token
- **æ¥å£æ•°é‡**:
  - HTTP API: 12ä¸ª
  - gRPC API: 3ä¸ª

**ä¸»è¦åŠŸèƒ½**:
- ç”¨æˆ·è®¤è¯ä¸ç®¡ç†
- èŠ‚ç‚¹ä¿¡æ¯ç®¡ç†
- Daemon æ³¨å†Œä¸å¿ƒè·³
- ç³»ç»ŸæŒ‡æ ‡æ¥æ”¶

---

### Daemon gRPC API (å¾…è¡¥å……)
- **æ–‡æ¡£**: `Daemon_gRPC_API.md` (è§„åˆ’ä¸­)
- **åè®®**: gRPC
- **ç«¯å£**: å¾…å®š
- **ä¸»è¦åŠŸèƒ½**:
  - æ¥æ”¶ Manager æŒ‡ä»¤
  - Agent ç®¡ç†
  - èµ„æºç›‘æ§

---

### Agent HTTP API (å¾…è¡¥å……)
- **æ–‡æ¡£**: `Agent_HTTP_API.md` (è§„åˆ’ä¸­)
- **åè®®**: HTTP/HTTPS
- **ç«¯å£**: å¾…å®š
- **ä¸»è¦åŠŸèƒ½**:
  - ä»»åŠ¡æ‰§è¡Œ
  - çŠ¶æ€æŸ¥è¯¢
  - æ–‡ä»¶æ“ä½œ

---

## ğŸ“– å¦‚ä½•ä½¿ç”¨

### 1. æŸ¥çœ‹ API æ–‡æ¡£
ç‚¹å‡»ä¸Šæ–¹çš„æ–‡æ¡£é“¾æ¥æŸ¥çœ‹è¯¦ç»†çš„ API è§„èŒƒã€‚

### 2. æµ‹è¯• API
æ¯ä¸ª API æ–‡æ¡£éƒ½åŒ…å« curl ç¤ºä¾‹ï¼Œå¯ä»¥ç›´æ¥å¤åˆ¶ä½¿ç”¨ã€‚

ä¾‹å¦‚æµ‹è¯• Manager å¥åº·æ£€æŸ¥ï¼š
```bash
curl -X GET http://localhost:8080/health
```

### 3. é›†æˆåˆ°é¡¹ç›®
æ ¹æ® API æ–‡æ¡£ç¼–å†™å®¢æˆ·ç«¯ä»£ç ï¼š

**Go ç¤ºä¾‹**:
```go
import (
    "bytes"
    "encoding/json"
    "net/http"
)

// ç”¨æˆ·ç™»å½•
func login(username, password string) (string, error) {
    body := map[string]string{
        "username": username,
        "password": password,
    }

    jsonData, _ := json.Marshal(body)
    resp, err := http.Post(
        "http://localhost:8080/api/v1/auth/login",
        "application/json",
        bytes.NewReader(jsonData),
    )
    if err != nil {
        return "", err
    }
    defer resp.Body.Close()

    var result map[string]interface{}
    json.NewDecoder(resp.Body).Decode(&result)

    data := result["data"].(map[string]interface{})
    token := data["token"].(string)

    return token, nil
}
```

---

## ğŸ”„ API ç‰ˆæœ¬ç®¡ç†

å½“å‰æ‰€æœ‰ API éƒ½åœ¨ v1 ç‰ˆæœ¬ï¼š
- Manager HTTP API: `/api/v1/*`
- gRPC API: `v1` package

### ç‰ˆæœ¬å…¼å®¹æ€§æ‰¿è¯º
- **å‘åå…¼å®¹**: åŒä¸€å¤§ç‰ˆæœ¬å†…ï¼ˆå¦‚ v1.xï¼‰ï¼Œä¿è¯å‘åå…¼å®¹
- **æ–°åŠŸèƒ½**: é€šè¿‡æ·»åŠ æ–°å­—æ®µæˆ–æ–°æ¥å£å®ç°
- **åºŸå¼ƒè­¦å‘Š**: åºŸå¼ƒçš„ API ä¼šåœ¨ä¸‹ä¸ªå¤§ç‰ˆæœ¬å‰è‡³å°‘ä¿ç•™ 6 ä¸ªæœˆ

---

## ğŸ“Š API çŠ¶æ€

| ç»„ä»¶ | æ–‡æ¡£çŠ¶æ€ | å®ç°çŠ¶æ€ | æµ‹è¯•çŠ¶æ€ |
|------|---------|---------|---------|
| Manager HTTP API | âœ… å®Œæˆ | âœ… å®Œæˆ | âœ… è‡ªåŠ¨åŒ–æµ‹è¯• |
| Manager gRPC API | âœ… å®Œæˆ | âœ… å®Œæˆ | â³ å¾…æµ‹è¯• |
| Daemon gRPC API | â³ è§„åˆ’ä¸­ | ğŸš§ å¼€å‘ä¸­ | âŒ æœªå¼€å§‹ |
| Agent HTTP API | â³ è§„åˆ’ä¸­ | ğŸš§ å¼€å‘ä¸­ | âŒ æœªå¼€å§‹ |

---

## ğŸ› ï¸ API æµ‹è¯•å·¥å…·

### Postman Collection
å¯ä»¥å¯¼å…¥ Postman è¿›è¡Œ API æµ‹è¯•ï¼ˆå¾…åˆ›å»ºï¼‰ã€‚

### è‡ªåŠ¨åŒ–æµ‹è¯•
Manager API å·²æœ‰å®Œæ•´çš„è‡ªåŠ¨åŒ–æµ‹è¯•å¥—ä»¶ï¼š
```bash
cd manager
go test -v ./test/integration/
```

è¯¦è§: [Manager é›†æˆæµ‹è¯•æ–‡æ¡£](../../manager/test/integration/README.md)

---

## ğŸ“ æ–‡æ¡£æ›´æ–°è®°å½•

| æ—¥æœŸ | ç»„ä»¶ | å˜æ›´å†…å®¹ |
|------|------|---------|
| 2025-12-03 | Manager | åˆ›å»ºå®Œæ•´ API æ–‡æ¡£ |
| 2025-12-03 | Manager | éªŒè¯æ–‡æ¡£ä¸ä»£ç ä¸€è‡´æ€§ |

---

## ğŸ¤ è´¡çŒ®æŒ‡å—

### å¦‚ä½•æ›´æ–° API æ–‡æ¡£

1. **ä¿®æ”¹ä»£ç ååŒæ­¥æ›´æ–°æ–‡æ¡£**
   - æ·»åŠ æ–°æ¥å£ â†’ æ›´æ–°æ–‡æ¡£
   - ä¿®æ”¹æ¥å£å‚æ•° â†’ æ›´æ–°æ–‡æ¡£
   - ä¿®æ”¹å“åº”æ ¼å¼ â†’ æ›´æ–°æ–‡æ¡£

2. **æ–‡æ¡£æ ¼å¼è§„èŒƒ**
   - ä½¿ç”¨ Markdown æ ¼å¼
   - åŒ…å«å®Œæ•´çš„è¯·æ±‚/å“åº”ç¤ºä¾‹
   - æä¾› curl å‘½ä»¤ç¤ºä¾‹
   - è¯´æ˜æ‰€æœ‰å‚æ•°çš„ç±»å‹å’Œå¿…å¡«æ€§

3. **éªŒè¯æ–‡æ¡£å‡†ç¡®æ€§**
   - ä½¿ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•éªŒè¯
   - ç¡®ä¿ç¤ºä¾‹å¯ä»¥ç›´æ¥è¿è¡Œ
   - ä¿æŒé”™è¯¯ç å®šä¹‰ä¸€è‡´

---

**ç»´æŠ¤**: Ops Scaffold Framework Team
**æœ€åæ›´æ–°**: 2025-12-03
