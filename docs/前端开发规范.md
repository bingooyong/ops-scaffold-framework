# Web 前端开发规范

> 本文档定义了 Ops Scaffold Framework Web 前端的开发标准和最佳实践，确保代码一致性和可维护性。

## 目录

- [1. 设计系统](#1-设计系统)
- [2. 项目结构规范](#2-项目结构规范)
- [3. 代码风格规范](#3-代码风格规范)
- [4. 组件开发规范](#4-组件开发规范)
- [5. 状态管理规范](#5-状态管理规范)
- [6. API 调用规范](#6-api-调用规范)
- [7. 路由规范](#7-路由规范)
- [8. 样式规范](#8-样式规范)
- [9. TypeScript 规范](#9-typescript-规范)
- [10. 测试规范](#10-测试规范)
- [11. 数据可视化规范](#11-数据可视化规范)
- [12. 监控业务规范](#12-监控业务规范)

---

## 1. 设计系统

### 1.1 设计原则

本项目基于 **Material Design 3** 设计系统，通过 **MUI v7** 实现。

**核心原则**：
- **一致性**：所有页面使用统一的组件和样式
- **可访问性**：符合 WCAG 2.1 AA 标准
- **响应式**：适配桌面、平板、移动设备
- **简洁性**：简洁明了的界面，避免冗余元素

### 1.2 主题配置

**主题文件位置**：`src/theme/index.ts`

```typescript
import { createTheme } from '@mui/material/styles';
import { zhCN } from '@mui/material/locale';

export const theme = createTheme(
  {
    palette: {
      mode: 'light',
      primary: {
        main: '#1976d2',
      },
      secondary: {
        main: '#dc004e',
      },
      error: {
        main: '#f44336',
      },
      warning: {
        main: '#ff9800',
      },
      success: {
        main: '#4caf50',
      },
    },
    typography: {
      fontFamily: [
        '-apple-system',
        'BlinkMacSystemFont',
        '"Segoe UI"',
        'Roboto',
        '"Helvetica Neue"',
        'Arial',
        'sans-serif',
      ].join(','),
    },
  },
  zhCN
);
```

**要求**：
- 所有颜色必须从主题中获取，禁止硬编码颜色值
- 使用 MUI 的 `sx` 属性或 `styled` API
- 支持暗色模式切换（未来扩展）

### 1.3 间距系统

使用 MUI 的 8px 基准间距系统：

```typescript
// 标准间距值
sx={{
  p: 2,   // padding: 16px (2 * 8px)
  mt: 3,  // margin-top: 24px (3 * 8px)
  mb: 4,  // margin-bottom: 32px (4 * 8px)
}}
```

**常用间距**：
- `0.5` = 4px（极小间距）
- `1` = 8px（小间距）
- `2` = 16px（标准间距）
- `3` = 24px（中等间距）
- `4` = 32px（大间距）
- `6` = 48px（超大间距）

### 1.4 布局规范

#### 1.4.1 页面布局

所有页面必须遵循以下布局结构：

```
┌─────────────────────────────────────────┐
│           TopBar (高度: 64px)            │
├──────┬──────────────────────────────────┤
│      │                                   │
│      │                                   │
│ Side │        Main Content               │
│ Bar  │                                   │
│ 240px│                                   │
│      │                                   │
└──────┴──────────────────────────────────┘
```

**布局组件**：`src/components/Layout/MainLayout.tsx`

#### 1.4.2 页面内容区域

```typescript
// 标准页面容器
<Box sx={{ p: 3 }}>
  <Typography variant="h4" gutterBottom>
    页面标题
  </Typography>

  <Box sx={{ mt: 3 }}>
    {/* 页面内容 */}
  </Box>
</Box>
```

#### 1.4.3 卡片布局

```typescript
<Card>
  <CardContent>
    {/* 内容 */}
  </CardContent>
</Card>
```

**卡片内边距**：
- 标准内容：`p: 3` (24px)
- 紧凑内容：`p: 2` (16px)
- 宽松内容：`p: 4` (32px)

### 1.5 表单布局

**标准表单间距**：

```typescript
<TextField
  fullWidth
  margin="normal"  // 16px 上下间距
  label="标签"
  {...register('fieldName')}
/>

<Button
  type="submit"
  variant="contained"
  sx={{ mt: 3 }}  // 表单底部按钮与最后一个字段间距 24px
>
  提交
</Button>
```

---

## 2. 项目结构规范

### 2.1 目录结构

```
web/
├── public/              # 静态资源
│   └── vite.svg
├── src/
│   ├── api/            # API 层
│   │   ├── client.ts       # Axios 客户端
│   │   ├── interceptors.ts # 拦截器
│   │   ├── auth.ts         # 认证 API
│   │   └── nodes.ts        # 节点 API
│   ├── assets/         # 资源文件
│   │   └── images/
│   ├── components/     # 通用组件
│   │   ├── Layout/         # 布局组件
│   │   ├── Table/          # 表格组件
│   │   └── Loading/        # 加载组件
│   ├── hooks/          # 自定义 Hooks
│   │   ├── useAuth.ts
│   │   └── useNodes.ts
│   ├── pages/          # 页面组件
│   │   ├── Login/
│   │   ├── Dashboard/
│   │   └── Nodes/
│   ├── router/         # 路由配置
│   │   ├── index.tsx
│   │   └── ProtectedRoute.tsx
│   ├── stores/         # 状态管理
│   │   └── authStore.ts
│   ├── theme/          # 主题配置
│   │   └── index.ts
│   ├── types/          # TypeScript 类型
│   │   ├── api.ts
│   │   ├── user.ts
│   │   └── node.ts
│   ├── utils/          # 工具函数
│   │   ├── storage.ts
│   │   └── format.ts
│   ├── App.tsx         # 根组件
│   ├── main.tsx        # 入口文件
│   └── index.css       # 全局样式
├── .env.development    # 开发环境变量
├── .env.production     # 生产环境变量
├── index.html
├── package.json
├── tsconfig.json
└── vite.config.ts
```

### 2.2 文件命名规范

| 类型 | 命名规则 | 示例 |
|------|----------|------|
| 组件文件 | PascalCase | `UserCard.tsx` |
| Hooks | camelCase + use 前缀 | `useAuth.ts` |
| 工具函数 | camelCase | `formatDate.ts` |
| 类型文件 | camelCase | `user.ts` |
| 常量文件 | camelCase | `constants.ts` |
| 样式文件 | camelCase | `styles.css` |

### 2.3 组件组织

每个功能组件应该有独立的目录：

```
components/UserCard/
├── index.tsx          # 组件主文件
├── UserCard.test.tsx  # 测试文件
├── types.ts           # 组件专用类型（可选）
└── README.md          # 组件文档（可选）
```

---

## 3. 代码风格规范

### 3.1 基本规则

- 使用 **TypeScript**，禁止使用 `any` 类型（除非必要）
- 使用 **函数组件** 和 **Hooks**，禁止使用类组件
- 使用 **箭头函数** 定义组件
- 每个文件只导出一个主组件
- 导入顺序：React → 第三方库 → 本地模块

### 3.2 导入顺序

```typescript
// 1. React 核心
import { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';

// 2. 第三方 UI 库
import { Box, Card, Typography } from '@mui/material';

// 3. 第三方工具库
import { useForm } from 'react-hook-form';
import { useQuery } from '@tanstack/react-query';

// 4. 本地 Hooks
import { useAuth } from '../../hooks';

// 5. 本地组件
import { UserCard } from '../../components';

// 6. 类型定义
import type { User } from '../../types';

// 7. 样式和资源
import './styles.css';
```

### 3.3 组件定义模板

```typescript
/**
 * 组件描述
 */

import { useState } from 'react';
import { Box, Typography } from '@mui/material';
import type { ComponentProps } from './types';

interface Props extends ComponentProps {
  // 组件属性定义
  title: string;
  onSubmit: (data: any) => void;
}

export default function ComponentName({ title, onSubmit }: Props) {
  // 1. Hooks
  const [state, setState] = useState('');

  // 2. 副作用
  useEffect(() => {
    // ...
  }, []);

  // 3. 事件处理函数
  const handleClick = () => {
    // ...
  };

  // 4. 渲染
  return (
    <Box>
      <Typography variant="h5">{title}</Typography>
    </Box>
  );
}
```

---

## 4. 组件开发规范

### 4.1 组件分类

#### 4.1.1 页面组件（Pages）

- 位置：`src/pages/`
- 职责：路由对应的页面，组织布局和业务逻辑
- 命名：PascalCase，如 `Dashboard.tsx`
- 默认导出

#### 4.1.2 布局组件（Layout）

- 位置：`src/components/Layout/`
- 职责：页面框架结构（顶栏、侧边栏、内容区）
- 示例：`MainLayout.tsx`, `TopBar.tsx`, `Sidebar.tsx`

#### 4.1.3 业务组件（Business Components）

- 位置：`src/components/[Domain]/`
- 职责：特定业务功能的组件
- 示例：`NodeCard.tsx`, `TaskList.tsx`

#### 4.1.4 通用组件（Common Components）

- 位置：`src/components/`
- 职责：可复用的 UI 组件
- 示例：`Loading.tsx`, `ErrorBoundary.tsx`

### 4.2 组件设计原则

#### 4.2.1 单一职责

每个组件只负责一个功能：

```typescript
// ❌ 不好：一个组件做太多事
function UserDashboard() {
  const [users, setUsers] = useState([]);
  const [stats, setStats] = useState({});
  const [charts, setCharts] = useState([]);
  // 包含用户列表、统计、图表...
}

// ✅ 好：拆分成多个组件
function UserDashboard() {
  return (
    <Box>
      <UserStats />
      <UserList />
      <UserCharts />
    </Box>
  );
}
```

#### 4.2.2 Props 类型定义

```typescript
// 使用 interface 定义 Props
interface UserCardProps {
  user: User;
  onEdit?: (user: User) => void;
  onDelete?: (id: number) => void;
  showActions?: boolean;
}

// 设置默认值
export default function UserCard({
  user,
  onEdit,
  onDelete,
  showActions = true,
}: UserCardProps) {
  // ...
}
```

#### 4.2.3 条件渲染

```typescript
// ✅ 好：使用早期返回
if (loading) {
  return <CircularProgress />;
}

if (error) {
  return <Alert severity="error">{error.message}</Alert>;
}

return <Box>{/* 正常内容 */}</Box>;
```

---

## 5. 状态管理规范

### 5.1 状态管理分层

| 状态类型 | 管理方式 | 适用场景 |
|---------|---------|---------|
| 组件状态 | `useState` | 仅组件内使用的状态 |
| 全局客户端状态 | Zustand | 认证信息、用户偏好 |
| 服务端状态 | React Query | API 数据、缓存 |

### 5.2 Zustand Store 规范

**Store 文件位置**：`src/stores/`

```typescript
import { create } from 'zustand';
import type { User } from '../types';

interface AuthState {
  // 状态
  user: User | null;
  token: string | null;
  isAuthenticated: boolean;

  // 操作
  setAuth: (user: User, token: string) => void;
  clearAuth: () => void;
  updateUser: (user: User) => void;
}

export const useAuthStore = create<AuthState>((set) => ({
  user: null,
  token: null,
  isAuthenticated: false,

  setAuth: (user, token) => {
    set({ user, token, isAuthenticated: true });
  },

  clearAuth: () => {
    set({ user: null, token: null, isAuthenticated: false });
  },

  updateUser: (user) => {
    set({ user });
  },
}));
```

**使用规范**：
- 每个 Store 负责一个领域的状态
- 使用 TypeScript 接口定义状态和操作
- 操作函数使用动词命名（set, clear, update, add, remove）

### 5.3 React Query 规范

**Hook 文件位置**：`src/hooks/`

```typescript
import { useQuery, useMutation, useQueryClient } from '@tanstack/react-query';
import { nodeAPI } from '../api';
import type { Node, PageResponse } from '../types';

// 查询 Hook
export function useNodes(page: number = 1, pageSize: number = 10) {
  return useQuery<PageResponse<Node>>({
    queryKey: ['nodes', page, pageSize],
    queryFn: () => nodeAPI.list(page, pageSize),
    staleTime: 5000, // 5秒内不重新请求
  });
}

// 变更 Hook
export function useDeleteNode() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (id: number) => nodeAPI.delete(id),
    onSuccess: () => {
      // 删除成功后刷新列表
      queryClient.invalidateQueries({ queryKey: ['nodes'] });
    },
  });
}
```

**命名规范**：
- 查询 Hook：`use[Resource]` 或 `use[Resource]List`
- 单个资源：`use[Resource]`
- 创建：`useCreate[Resource]`
- 更新：`useUpdate[Resource]`
- 删除：`useDelete[Resource]`

---

## 6. API 调用规范

### 6.1 API 层组织

**文件位置**：`src/api/`

```
api/
├── client.ts          # Axios 客户端配置
├── interceptors.ts    # 请求/响应拦截器
├── auth.ts            # 认证相关 API
├── nodes.ts           # 节点相关 API
└── tasks.ts           # 任务相关 API
```

### 6.2 API 模块模板

```typescript
import client from './client';
import type { APIResponse, PageResponse, Node } from '../types';

/**
 * 节点管理 API
 */
export const nodeAPI = {
  /**
   * 获取节点列表
   */
  list: async (page: number = 1, pageSize: number = 10) => {
    const response = await client.get<APIResponse<PageResponse<Node>>>(
      '/api/v1/nodes',
      {
        params: { page, page_size: pageSize },
      }
    );
    return response.data.data;
  },

  /**
   * 获取单个节点
   */
  get: async (id: number) => {
    const response = await client.get<APIResponse<Node>>(`/api/v1/nodes/${id}`);
    return response.data.data;
  },

  /**
   * 删除节点
   */
  delete: async (id: number) => {
    const response = await client.delete<APIResponse<void>>(`/api/v1/nodes/${id}`);
    return response.data.data;
  },
};
```

### 6.3 类型导入规范

**重要**：TypeScript 类型必须使用 `import type` 语法：

```typescript
// ✅ 正确：使用 import type
import type { AxiosInstance, AxiosError } from 'axios';
import type { APIResponse } from '../types';

// ❌ 错误：会导致运行时错误
import { AxiosInstance } from 'axios';
```

---

## 7. 路由规范

### 7.1 路由结构

```
/                   → 重定向到 /dashboard
/login              → 登录页（公开）
/dashboard          → 仪表盘（需认证）
/nodes              → 节点列表（需认证）
/nodes/:id          → 节点详情（需认证）
/tasks              → 任务列表（需认证）
```

### 7.2 路由配置

**文件位置**：`src/App.tsx`

```typescript
<BrowserRouter>
  <Routes>
    <Route path="/login" element={<Login />} />

    <Route
      path="/"
      element={
        <ProtectedRoute>
          <MainLayout />
        </ProtectedRoute>
      }
    >
      <Route index element={<Navigate to="/dashboard" replace />} />
      <Route path="dashboard" element={<Dashboard />} />
      <Route path="nodes" element={<NodeList />} />
      <Route path="nodes/:id" element={<NodeDetail />} />
    </Route>

    <Route path="*" element={<Navigate to="/dashboard" replace />} />
  </Routes>
</BrowserRouter>
```

### 7.3 路由保护

**ProtectedRoute 组件**：

```typescript
interface ProtectedRouteProps {
  children: ReactNode;
}

export function ProtectedRoute({ children }: ProtectedRouteProps) {
  const { isAuthenticated } = useAuthStore();

  if (!isAuthenticated) {
    return <Navigate to="/login" replace />;
  }

  return <>{children}</>;
}
```

---

## 8. 样式规范

### 8.1 样式方案

本项目使用 **MUI `sx` 属性** 作为主要样式方案。

#### 8.1.1 sx 属性（推荐）

```typescript
<Box
  sx={{
    display: 'flex',
    alignItems: 'center',
    justifyContent: 'space-between',
    p: 2,
    bgcolor: 'background.paper',
    borderRadius: 1,
  }}
>
  {/* 内容 */}
</Box>
```

#### 8.1.2 styled API（复杂样式）

```typescript
import { styled } from '@mui/material/styles';

const StyledCard = styled(Card)(({ theme }) => ({
  padding: theme.spacing(3),
  borderRadius: theme.spacing(2),
  '&:hover': {
    boxShadow: theme.shadows[4],
  },
}));
```

### 8.2 全局样式

**文件位置**：`src/index.css`

**原则**：
- 仅用于 CSS 重置和极少量全局样式
- 禁止在全局样式中定义组件样式
- MUI `CssBaseline` 已处理大部分重置

```css
* {
  box-sizing: border-box;
}

body {
  margin: 0;
  padding: 0;
}

#root {
  min-height: 100vh;
}
```

### 8.3 响应式设计

使用 MUI 的 breakpoint 系统：

```typescript
<Box
  sx={{
    display: 'flex',
    flexDirection: { xs: 'column', md: 'row' }, // 手机竖排，桌面横排
    gap: { xs: 2, md: 3 },
    p: { xs: 2, sm: 3, md: 4 },
  }}
>
  {/* 内容 */}
</Box>
```

**Breakpoints**：
- `xs`: 0px+（手机）
- `sm`: 600px+（平板竖屏）
- `md`: 900px+（平板横屏、小笔记本）
- `lg`: 1200px+（桌面）
- `xl`: 1536px+（大屏）

---

## 9. TypeScript 规范

### 9.1 类型定义

#### 9.1.1 类型文件组织

```
types/
├── api.ts        # API 响应类型
├── user.ts       # 用户相关类型
├── node.ts       # 节点相关类型
└── index.ts      # 统一导出
```

#### 9.1.2 类型定义规范

```typescript
// 使用 interface 定义对象类型
export interface User {
  id: number;
  username: string;
  email: string;
  role: UserRole;
  created_at: string;
  updated_at: string;
}

// 使用 enum 定义枚举
export enum UserRole {
  Admin = 'admin',
  User = 'user',
}

// 使用 type 定义联合类型
export type NodeStatus = 'online' | 'offline' | 'error';
```

### 9.2 严格模式

`tsconfig.json` 必须启用严格模式：

```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "strictBindCallApply": true
  }
}
```

### 9.3 禁止使用 any

```typescript
// ❌ 禁止
function fetchData(): any {
  // ...
}

// ✅ 使用具体类型
function fetchData(): Promise<User[]> {
  // ...
}

// ✅ 不确定类型时使用 unknown
function processData(data: unknown) {
  if (typeof data === 'string') {
    // 类型收窄后使用
  }
}
```

---

## 10. 测试规范

### 10.1 测试文件组织

```
src/components/UserCard/
├── UserCard.tsx
└── UserCard.test.tsx
```

### 10.2 测试框架

- **单元测试**：Vitest + React Testing Library
- **E2E 测试**：Playwright（待实现）

### 10.3 测试覆盖率目标

| 层级 | 目标覆盖率 |
|------|-----------|
| 工具函数 | > 90% |
| Hooks | > 80% |
| 组件 | > 70% |
| 页面 | > 60% |

---

## 11. 数据可视化规范

### 11.1 图表库选型与封装

- **标准库**：指定 **Apache ECharts 6.0** (via `echarts-for-react`) 为唯一图表库。
- **封装原则**：禁止在页面直接使用 `<ReactECharts />`，必须使用封装好的业务组件（如 `<BaseChart />`），统一处理 Resize、Theme 切换和 Loading 状态。

### 11.2 视觉呈现标准

- **配色方案**：
  - 使用 MUI 主题色板，保持与 UI 一致。
  - CPU: 蓝色系 (`theme.palette.primary.main`)
  - 内存: 紫色系 (`theme.palette.secondary.main`)
  - 磁盘: 绿色系 (`theme.palette.success.main`)
  - 网络: 橙色系 (`theme.palette.warning.main`)
- **阈值线 (Thresholds)**：
  - **Warning (>80%)**: 橙色虚线
  - **Critical (>90%)**: 红色虚线
- **图例 (Legend)**：统一放置在底部或顶部右侧，支持点击切换显示。

### 11.3 状态处理

- **Loading**：图表加载时必须显示骨架屏或 Loading Spinner，高度需占位防止抖动。
- **No Data**：无数据时显示统一的 Empty State 插画，而不是空白或空坐标轴。
- **Error**：数据加载失败时显示错误提示和重试按钮。

### 11.4 Tooltip 交互

- 必须包含：时间点、指标名称、数值、单位。
- 多序列图表必须启用 `trigger: 'axis'` 以同步显示 Tooltip。
- 数值必须格式化（如保留 2 位小数）。

---

## 12. 监控业务规范

### 12.1 数据格式化

- **后端原则**：后端应返回原始数值（如 bytes, bits/s），**严禁**返回格式化后的字符串。
- **前端格式化**：前端统一使用 `utils/format.ts` 中的函数进行格式化。
- **单位标准**：
  - 流量/存储：B -> KB -> MB -> GB (1024 进制)
  - 速率：bps, pps
  - 时间：ms -> s -> m -> h
- **精度控制**：统一保留小数点后 2 位，接近 0 或 100 时需特殊处理（如 `99.99%`）。

### 12.2 实时刷新机制

- **刷新策略**：默认 30s 轮询 (Polling)，使用 React Query 的 `refetchInterval`。
- **页面可见性**：当页面不可见（Tab 切换或最小化）时，**必须暂停轮询**以节省资源（React Query 默认支持）。
- **反馈**：在页面显著位置（如右上角）显示“最后更新时间”。

### 12.3 告警分级展示

- **Critical**: 红色 (`theme.palette.error.main`)，配合实心图标，必要时闪烁。
- **Warning**: 橙色 (`theme.palette.warning.main`)，配合空心图标。
- **Info/Normal**: 绿色 (`theme.palette.success.main`) 或 蓝色 (`theme.palette.primary.main`)。

---

## 附录

### A. 常用 MUI 组件

| 组件 | 用途 |
|------|------|
| `Box` | 通用容器 |
| `Card` | 卡片容器 |
| `Typography` | 文本显示 |
| `Button` | 按钮 |
| `TextField` | 输入框 |
| `Select` | 下拉选择 |
| `Table` | 表格 |
| `Grid` | 网格布局 |
| `Container` | 页面容器 |
| `Alert` | 提示信息 |
| `Dialog` | 对话框 |
| `Snackbar` | 轻量提示 |

### B. VSCode 推荐扩展

- **ESLint** - 代码检查
- **Prettier** - 代码格式化
- **TypeScript Vue Plugin (Volar)** - TypeScript 支持
- **Auto Rename Tag** - 自动重命名标签
- **ES7+ React/Redux/React-Native snippets** - React 代码片段

### C. 参考资源

- [Material-UI 官方文档](https://mui.com/)
- [React 官方文档](https://react.dev/)
- [TypeScript 官方文档](https://www.typescriptlang.org/)
- [React Query 文档](https://tanstack.com/query/)
- [Zustand 文档](https://zustand-demo.pmnd.rs/)

---

**文档版本**: v1.1.0
**最后更新**: 2025-12-08
**维护者**: Ops Scaffold Framework Team
